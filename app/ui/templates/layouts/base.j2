{% import "partials/_strings.j2" as strings %}
{% import "partials/alerts.j2" as alerts %}
{% import "partials/modals.j2" as modals %}
{% import "partials/nav.j2" as nav %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{{ strings.page_title(layout.page_id) }}</title>
    <link rel="stylesheet" href="{{ asset_url('css/app.css') }}" />
    {% block head_extras -%}
      {% for meta in layout.head_meta %}
        <meta name="{{ meta.name }}" content="{{ meta.content }}" />
      {% endfor %}
    {%- endblock %}
  </head>
  <body data-role="{{ layout.role or 'anonymous' }}"
        data-live-updates="{{ layout.live_updates_mode }}"
        {% if layout.live_updates_source %}data-live-source="{{ layout.live_updates_source }}"{% endif %}>
    <header>
      <h1>{{ strings.app_name() }}</h1>
      {% if layout.navigation.primary %}
        {{ nav.render_primary_nav(layout.navigation.primary) }}
      {% endif %}
      {% block header_actions %}{% endblock %}
    </header>
    <div id="ui-alert-region" data-role="alert-region" aria-live="polite" aria-atomic="true">
      {{ alerts.render_alerts(layout.alerts) }}
    </div>
    <main role="main">
      {% block page_header %}{% endblock %}
      {% block main %}{% endblock %}
    </main>
    <footer>
      {% block footer %}{% endblock %}
    </footer>
    {% block modals %}
      {{ modals.render_modals(layout.modals) }}
      <div id="modal-root" data-role="modal-container"></div>
    {% endblock %}
    {% block scripts %}
      {% set ui_assets = get_ui_assets() %}
      {% if ui_assets.htmx.uses_cdn %}
        <script src="{{ ui_assets.htmx.cdn_url }}" integrity="{{ ui_assets.htmx.integrity }}" crossorigin="{{ ui_assets.htmx.crossorigin }}" defer></script>
        <script data-fallback src="{{ asset_url(ui_assets.htmx.local_asset_path) }}" defer></script>
      {% else %}
        <script src="{{ asset_url(ui_assets.htmx.local_asset_path) }}" defer></script>
      {% endif %}
      <script src="{{ asset_url('js/ui-bootstrap.js') }}" defer></script>
      <script src="{{ asset_url('js/htmx-error-handler.js') }}" defer></script>
      <script src="{{ asset_url('js/polling-controller.js') }}" defer></script>
    {% endblock %}
  </body>
</html>
