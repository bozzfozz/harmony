{% import "partials/_strings.j2" as strings %}
{% import "partials/tables.j2" as tables %}

{% set default_fragment_selector = "#" + fragment.identifier %}
{% set action_target = fragment.data_attributes.get("action-target", default_fragment_selector) %}
{% set action_swap = fragment.data_attributes.get("action-swap", "outerHTML") %}
{% set modal_target = fragment.data_attributes.get("modal-target", "#modal-root") %}
{% set modal_swap = fragment.data_attributes.get("modal-swap", "innerHTML") %}
{% set fragment_target = fragment.pagination.target if fragment.pagination else action_target %}
{% set fragment_swap = fragment.pagination.swap if fragment.pagination else action_swap %}

{% if active_url and all_url and refresh_url %}
  <div class="table-controls">
    <div class="table-controls__group">
      <button type="button"
              hx-get="{{ active_url }}"
              hx-target="{{ fragment_target }}"
              hx-swap="{{ fragment_swap }}"
              {% if not include_all %}disabled{% endif %}>
        {{ strings.button_label("soulseek.downloads.show_active") }}
      </button>
      <button type="button"
              hx-get="{{ all_url }}"
              hx-target="{{ fragment_target }}"
              hx-swap="{{ fragment_swap }}"
              {% if include_all %}disabled{% endif %}>
        {{ strings.button_label("soulseek.downloads.show_all") }}
      </button>
    </div>
    <div class="table-controls__group">
      <button type="button"
              hx-get="{{ refresh_url }}"
              hx-target="{{ fragment_target }}"
              hx-swap="{{ fragment_swap }}">
        {{ strings.button_label("soulseek.downloads.refresh") }}
      </button>
      <form method="post"
            action="{{ cleanup_url }}"
            hx-delete="{{ cleanup_url }}"
            hx-target="{{ cleanup_target }}"
            hx-swap="{{ cleanup_swap }}">
        <input type="hidden" name="csrftoken" value="{{ csrf_token }}" />
        {% if fragment.data_attributes.get("limit") %}
          <input type="hidden"
                 name="limit"
                 value="{{ fragment.data_attributes.get("limit") }}" />
        {% endif %}
        {% if fragment.data_attributes.get("offset") %}
          <input type="hidden"
                 name="offset"
                 value="{{ fragment.data_attributes.get("offset") }}" />
        {% endif %}
        <input type="hidden"
               name="scope"
               value="{{ "all" if include_all else "active" }}" />
        <button type="submit"
                data-test="soulseek-downloads-cleanup"
                {% if cleanup_disabled %}disabled{% endif %}>
          {{ strings.button_label("soulseek.downloads.cleanup") }}
        </button>
      </form>
    </div>
  </div>
{% endif %}

{{ tables.render_table_fragment(fragment) }}
