{% import "partials/_strings.j2" as strings %}
{% import "partials/status_badges.j2" as status_badges %}

<article id="{{ card.target_id }}"
         class="system-secret-card"
         data-provider="{{ card.slug }}"
         data-provider-key="{{ card.provider }}"
         aria-live="polite">
  <header class="system-secret-card__header">
    <h4 class="system-secret-card__title">{{ strings.system_secret_title(card.title_key) }}</h4>
    <p class="system-secret-card__description">{{ strings.system_secret_description(card.description_key) }}</p>
  </header>
  {% if card.can_validate %}
    <form id="{{ card.form.identifier }}"
          class="form system-secret-card__form"
          method="{{ card.form.method }}"
          action="{{ card.form.action }}"
          hx-post="{{ card.form.action }}"
          hx-target="#{{ card.target_id }}"
          hx-swap="outerHTML">
      <input type="hidden" name="csrftoken" value="{{ csrf_token }}" />
      {% for field in card.form.fields %}
        <div class="form-field">
          <label for="{{ card.slug }}-{{ field.name }}">{{ strings.form_label(field.label_key) }}</label>
          <input type="{{ field.input_type }}"
                 id="{{ card.slug }}-{{ field.name }}"
                 name="{{ field.name }}"
                 {% if field.autocomplete %}autocomplete="{{ field.autocomplete }}"{% endif %} />
        </div>
      {% endfor %}
      <button type="submit">{{ strings.button_label(card.form.submit_label_key) }}</button>
    </form>
  {% else %}
    <p class="system-secret-card__notice">{{ strings.system_secret_admin_required() }}</p>
  {% endif %}

  {% if card.result %}
    <div class="system-secret-card__result">
      <div class="system-secret-card__status">
        {{ status_badges.render_badge(card.result.badge) }}
        <span class="system-secret-card__status-text">{{ strings.system_secret_mode(card.result.mode_key) }}</span>
      </div>
      <dl class="system-secret-card__details">
        <div>
          <dt>{{ strings.system_field_label("validated_at") }}</dt>
          <dd>{{ card.result.validated_at if card.result.validated_at else strings.system_field_placeholder() }}</dd>
        </div>
        <div>
          <dt>{{ strings.system_field_label("note") }}</dt>
          <dd>{{ card.result.note if card.result.note else strings.system_field_placeholder() }}</dd>
        </div>
        <div>
          <dt>{{ strings.system_field_label("reason") }}</dt>
          <dd>{{ card.result.reason if card.result.reason else strings.system_field_placeholder() }}</dd>
        </div>
      </dl>
    </div>
  {% endif %}
</article>
