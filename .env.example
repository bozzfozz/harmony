# Harmony environment example
# Copy to .env and adjust values for your environment.

# Core runtime
APP_ENV=dev
HOST=127.0.0.1
PORT=8080

# PostgreSQL connection
POSTGRES_HOST=127.0.0.1
POSTGRES_PORT=5432
POSTGRES_DB=harmony
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
DATABASE_SSLMODE=disable
DATABASE_URL=postgresql+psycopg://postgres:postgres@${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}?sslmode=${DATABASE_SSLMODE}
API_BASE_PATH=/api/v1
HARMONY_LOG_LEVEL=INFO
FEATURE_REQUIRE_AUTH=false
FEATURE_RATE_LIMITING=false
HARMONY_DISABLE_WORKERS=0
WORKERS_ENABLED=true

# Authentication & access control
HARMONY_API_KEYS=local-dev-key
HARMONY_API_KEYS_FILE=
AUTH_ALLOWLIST=/api/v1/health,/api/v1/ready,/api/health/ready
ALLOWED_ORIGINS=http://127.0.0.1:8080

# Observability
HEALTH_DB_TIMEOUT_MS=500
HEALTH_DEP_TIMEOUT_MS=800
HEALTH_DEPS=spotify
HEALTH_READY_REQUIRE_DB=true

# Caching
CACHE_ENABLED=true
CACHE_DEFAULT_TTL_S=30
CACHE_STALE_WHILE_REVALIDATE_S=60
CACHE_MAX_ITEMS=5000
CACHE_FAIL_OPEN=true
CACHEABLE_PATHS=/api/v1/library/*|300|600
CACHE_STRATEGY_ETAG=strong

# Spotify & integrations
SPOTIFY_CLIENT_ID=changeme
SPOTIFY_CLIENT_SECRET=changeme
SPOTIFY_REDIRECT_URI=http://127.0.0.1:8080/callback
SPOTIFY_SCOPE=user-library-read playlist-read-private playlist-read-collaborative
SPOTIFY_MODE=PRO
SLSKD_BASE_URL=http://127.0.0.1:5030
SLSKD_API_KEY=
INTEGRATIONS_ENABLED=spotify,slskd
PROVIDER_MAX_CONCURRENCY=4
SPOTIFY_TIMEOUT_MS=15000
PLEX_TIMEOUT_MS=15000
SLSKD_TIMEOUT_MS=8000
SLSKD_RETRY_MAX=3
SLSKD_RETRY_BACKOFF_BASE_MS=250
SLSKD_PREFERRED_FORMATS=FLAC,ALAC,APE,MP3
SLSKD_MAX_RESULTS=50

# Ingest & backfill
FREE_IMPORT_MAX_LINES=200
FREE_IMPORT_MAX_FILE_BYTES=1048576
FREE_IMPORT_MAX_PLAYLIST_LINKS=1000
FREE_IMPORT_HARD_CAP_MULTIPLIER=10
FREE_ACCEPT_USER_URLS=false
FREE_MAX_PLAYLISTS=100
FREE_MAX_TRACKS_PER_REQUEST=5000
FREE_BATCH_SIZE=500
INGEST_BATCH_SIZE=500
INGEST_MAX_PENDING_JOBS=100
BACKFILL_MAX_ITEMS=2000
BACKFILL_CACHE_TTL_SEC=604800

# Workers & retries
ORCH_GLOBAL_CONCURRENCY=8
ORCH_POOL_SYNC=4
ORCH_POOL_MATCHING=4
ORCH_POOL_RETRY=2
ORCH_POOL_WATCHLIST=2
ORCH_PRIORITY_JSON={"sync":100,"matching":90,"retry":80,"watchlist":50}
ORCH_VISIBILITY_TIMEOUT_S=60
ORCH_HEARTBEAT_S=20
ORCH_POLL_INTERVAL_MS=200
EXTERNAL_TIMEOUT_MS=10000
EXTERNAL_RETRY_MAX=3
EXTERNAL_BACKOFF_BASE_MS=250
EXTERNAL_JITTER_PCT=20
WATCHLIST_INTERVAL=86400
WATCHLIST_MAX_CONCURRENCY=3
WATCHLIST_MAX_PER_TICK=20
WATCHLIST_SPOTIFY_TIMEOUT_MS=8000
WATCHLIST_SLSKD_SEARCH_TIMEOUT_MS=12000
WATCHLIST_TICK_BUDGET_MS=8000
WATCHLIST_BACKOFF_BASE_MS=250
WATCHLIST_RETRY_MAX=3
WATCHLIST_RETRY_BUDGET_PER_ARTIST=6
WATCHLIST_COOLDOWN_MINUTES=15
WATCHLIST_DB_IO_MODE=thread
WATCHLIST_JITTER_PCT=0.2
WATCHLIST_SHUTDOWN_GRACE_MS=2000
WATCHLIST_TIMER_ENABLED=true
WATCHLIST_TIMER_INTERVAL_S=900
SYNC_WORKER_CONCURRENCY=2
RETRY_MAX_ATTEMPTS=10
RETRY_BASE_SECONDS=60
RETRY_JITTER_PCT=0.2
RETRY_SCAN_INTERVAL_SEC=60
RETRY_SCAN_BATCH_LIMIT=100
MATCHING_WORKER_BATCH_SIZE=10
MATCHING_CONFIDENCE_THRESHOLD=0.65
FEATURE_MATCHING_EDITION_AWARE=true
MATCH_FUZZY_MAX_CANDIDATES=50
MATCH_MIN_ARTIST_SIM=0.6
MATCH_COMPLETE_THRESHOLD=0.9
MATCH_NEARLY_THRESHOLD=0.8

# Artwork & lyrics
ENABLE_ARTWORK=false
ENABLE_LYRICS=false
ARTWORK_DIR=./artwork
ARTWORK_HTTP_TIMEOUT=15
ARTWORK_MAX_BYTES=10485760
ARTWORK_WORKER_CONCURRENCY=2
ARTWORK_MIN_EDGE=1000
ARTWORK_MIN_BYTES=150000
ARTWORK_FALLBACK_ENABLED=false
ARTWORK_FALLBACK_PROVIDER=musicbrainz
ARTWORK_FALLBACK_TIMEOUT_SEC=12
ARTWORK_FALLBACK_MAX_BYTES=10485760
MUSIXMATCH_API_KEY=

# Error handling & validation
FEATURE_UNIFIED_ERROR_FORMAT=true
ERRORS_DEBUG_DETAILS=false
SECRET_VALIDATE_TIMEOUT_MS=800
SECRET_VALIDATE_MAX_PER_MIN=3

# Search & DLQ
SEARCH_TIMEOUT_MS=8000
SEARCH_MAX_LIMIT=100
DLQ_PAGE_SIZE_DEFAULT=25
DLQ_PAGE_SIZE_MAX=100
DLQ_REQUEUE_LIMIT=500
DLQ_PURGE_LIMIT=1000

# Storage
MUSIC_DIR=./music

# Frontend (Vite) defaults
VITE_API_URL=http://127.0.0.1:8080
VITE_API_BASE_PATH=/api/v1
VITE_REQUIRE_AUTH=false
VITE_AUTH_HEADER_MODE=x-api-key
VITE_API_KEY=
VITE_LIBRARY_POLL_INTERVAL_MS=15000
VITE_RUNTIME_API_KEY=
