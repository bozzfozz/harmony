# Harmony configuration example
#
# All keys are optional. Runtime precedence: environment variables > .env > code defaults.
# Provide production secrets via the environment, never commit real credentials.

########## Core ##########
# Default: sqlite+aiosqlite:///./harmony.db
DATABASE_URL=sqlite+aiosqlite:///./harmony.db
# Default: 8080
APP_PORT=8080
# Default: 0 (disabled)
DB_RESET=0
# Default: dev
APP_ENV=dev
# Default: dev (alias for APP_ENV)
ENVIRONMENT=dev
# Default: default
HARMONY_PROFILE=default
# Default: INFO
HARMONY_LOG_LEVEL=INFO
# Default: /api/v1
API_BASE_PATH=/api/v1
# Default: X-Request-ID
REQUEST_ID_HEADER=X-Request-ID
# Default: (unset)
PYTEST_CURRENT_TEST=
# Default: (unset)
PUBLIC_BACKEND_URL=
# Default: /live
SMOKE_PATH=/live

########## Auth & Security ##########
# Default: true
FEATURE_UNIFIED_ERROR_FORMAT=true
# Default: false
ERRORS_DEBUG_DETAILS=false
# Default: false
FEATURE_REQUIRE_AUTH=false
# Default: false
FEATURE_RATE_LIMITING=false
# Default: false
FEATURE_ENABLE_LEGACY_ROUTES=false
# Default: false
FEATURE_ADMIN_API=false
# Default: (unset)
HARMONY_API_KEYS=
# Default: (unset)
HARMONY_API_KEYS_FILE=
# Default: automatic health/docs/openapi allowlist
AUTH_ALLOWLIST=
# Default: (unset)
ALLOWED_ORIGINS=
# Default: (unset)
CORS_ALLOWED_ORIGINS=
# Default: *
CORS_ALLOWED_HEADERS=*
# Default: GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS

########## Environment & Workers ##########
# Default: false
HARMONY_DISABLE_WORKERS=false
# Default: true
WORKERS_ENABLED=true
# Default: (unset)
WORKER_VISIBILITY_TIMEOUT_S=

########## Database-backed Feature Flags ##########
# Default: false
ENABLE_ARTWORK=false
# Default: false
ENABLE_LYRICS=false
# Default: false
ARTIST_CACHE_INVALIDATE=false

########## Observability & Middleware ##########
# Default: true
CACHE_ENABLED=true
# Default: 30
CACHE_DEFAULT_TTL_S=30
# Default: 60
CACHE_STALE_WHILE_REVALIDATE_S=60
# Default: 5000
CACHE_MAX_ITEMS=5000
# Default: true
CACHE_FAIL_OPEN=true
# Default: strong
CACHE_STRATEGY_ETAG=strong
# Default: true
CACHE_WRITE_THROUGH=true
# Default: true
CACHE_LOG_EVICTIONS=true
# Default: (unset)
CACHEABLE_PATHS=
# Default: 1024
GZIP_MIN_SIZE=1024
# Default: 500
HEALTH_DB_TIMEOUT_MS=500
# Default: 800
HEALTH_DEP_TIMEOUT_MS=800
# Default: (unset)
HEALTH_DEPS=
# Default: true
HEALTH_READY_REQUIRE_DB=true

########## Integrations ##########
# Default: spotify,slskd
INTEGRATIONS_ENABLED=spotify,slskd
# Default: (unset)
SPOTIFY_CLIENT_ID=
# Default: (unset)
SPOTIFY_CLIENT_SECRET=
# Default: (unset)
SPOTIFY_REDIRECT_URI=
# Default: user-library-read playlist-read-private playlist-read-collaborative
SPOTIFY_SCOPE=user-library-read playlist-read-private playlist-read-collaborative
# Default: 15000
SPOTIFY_TIMEOUT_MS=15000
# Default: http://localhost:5030
SLSKD_BASE_URL=http://localhost:5030
# Default: (legacy fallback)
SLSKD_URL=
# Default: (legacy host override)
SLSKD_HOST=
# Default: (legacy port override)
SLSKD_PORT=
# Default: (unset)
SLSKD_API_KEY=
# Default: 8000
SLSKD_TIMEOUT_MS=8000
# Default: 3
SLSKD_RETRY_MAX=3
# Default: 250
SLSKD_RETRY_BACKOFF_BASE_MS=250
# Default: 20 (percent jitter)
SLSKD_JITTER_PCT=20
# Default: (unset)
SLSKD_PREFERRED_FORMATS=
# Default: 200
SLSKD_MAX_RESULTS=200
# Default: (unset)
MUSIXMATCH_API_KEY=
# Default: (unset)
PUBLIC_BACKEND_URL=

########## External Call Defaults ##########
# Default: 15000
EXTERNAL_TIMEOUT_MS=15000
# Default: 3
EXTERNAL_RETRY_MAX=3
# Default: 250
EXTERNAL_BACKOFF_BASE_MS=250
# Default: 20 (percent jitter)
EXTERNAL_JITTER_PCT=20
# Default: 10
PROVIDER_MAX_CONCURRENCY=10

########## Artwork ##########
# Default: ./artwork
ARTWORK_DIR=./artwork
# Default: ./artwork (deprecated override)
HARMONY_ARTWORK_DIR=./artwork
# Default: 15.0
ARTWORK_TIMEOUT_SEC=15.0
# Default: 15.0
ARTWORK_HTTP_TIMEOUT=15.0
# Default: 10485760
ARTWORK_MAX_BYTES=10485760
# Default: 2
ARTWORK_CONCURRENCY=2
# Default: 2
ARTWORK_WORKER_CONCURRENCY=2
# Default: 1000
ARTWORK_MIN_EDGE=1000
# Default: 150000
ARTWORK_MIN_BYTES=150000
# Default: false
ARTWORK_FALLBACK_ENABLED=false
# Default: musicbrainz
ARTWORK_FALLBACK_PROVIDER=musicbrainz
# Default: 12.0
ARTWORK_FALLBACK_TIMEOUT_SEC=12.0
# Default: 10485760
ARTWORK_FALLBACK_MAX_BYTES=10485760
# Default: false
ARTWORK_POST_PROCESSING_ENABLED=false
# Default: (unset)
ARTWORK_POST_PROCESSORS=

########## Free Import & Backfill ##########
# Default: 200
FREE_IMPORT_MAX_LINES=200
# Default: 1048576
FREE_IMPORT_MAX_FILE_BYTES=1048576
# Default: 1000
FREE_IMPORT_MAX_PLAYLIST_LINKS=1000
# Default: 10
FREE_IMPORT_HARD_CAP_MULTIPLIER=10
# Default: false
FREE_ACCEPT_USER_URLS=false
# Default: 500
FREE_BATCH_SIZE=500
# Default: 100
FREE_MAX_PLAYLISTS=100
# Default: 5000
FREE_MAX_TRACKS_PER_REQUEST=5000
# Default: 1000
BACKFILL_MAX_ITEMS=1000
# Default: 43200
BACKFILL_CACHE_TTL_SEC=43200

########## Ingest ##########
# Default: 500
INGEST_BATCH_SIZE=500
# Default: 2000
INGEST_MAX_PENDING_JOBS=2000

########## Matching & Search ##########
# Default: true
FEATURE_MATCHING_EDITION_AWARE=true
# Default: 50
MATCH_FUZZY_MAX_CANDIDATES=50
# Default: 0.6
MATCH_MIN_ARTIST_SIM=0.6
# Default: 0.9
MATCH_COMPLETE_THRESHOLD=0.9
# Default: 0.8
MATCH_NEARLY_THRESHOLD=0.8
# Default: 5
MATCHING_WORKER_BATCH_SIZE=5
# Default: 0.65
MATCHING_CONFIDENCE_THRESHOLD=0.65
# Default: 100
SEARCH_MAX_LIMIT=100

########## Retry & Rate Limiting ##########
# Default: 10
RETRY_MAX_ATTEMPTS=10
# Default: 60.0
RETRY_BASE_SECONDS=60.0
# Default: 0.2 (fraction)
RETRY_JITTER_PCT=0.2
# Default: 25
RETRY_SCAN_BATCH_LIMIT=25
# Default: 180
RETRY_SCAN_INTERVAL_SEC=180
# Default: 60
RATE_LIMIT_BUCKET_CAP=60
# Default: 1.0
RATE_LIMIT_REFILL_PER_SEC=1.0

########## Watchlist & Orchestrator ##########
# Default: (unset)
WATCHLIST_MAX_CONCURRENCY=
# Default: (unset)
WATCHLIST_CONCURRENCY=
# Default: (unset)
WATCHLIST_MAX_PER_TICK=
# Default: (unset)
WATCHLIST_TICK_BUDGET_MS=
# Default: (unset)
WATCHLIST_RETRY_MAX=
# Default: (unset)
WATCHLIST_BACKOFF_MAX_TRIES=
# Default: (unset)
WATCHLIST_BACKOFF_BASE_MS=
# Default: (unset)
WATCHLIST_JITTER_PCT=
# Default: (unset)
WATCHLIST_RETRY_BUDGET_PER_ARTIST=
# Default: (unset)
ARTIST_MAX_RETRY_PER_ARTIST=
# Default: (unset)
WATCHLIST_SPOTIFY_TIMEOUT_MS=
# Default: (unset)
WATCHLIST_SLSKD_SEARCH_TIMEOUT_MS=
# Default: (unset)
WATCHLIST_SEARCH_TIMEOUT_MS=
# Default: (unset)
WATCHLIST_SHUTDOWN_GRACE_MS=
# Default: (unset)
WATCHLIST_DB_IO_MODE=
# Default: (unset)
WATCHLIST_COOLDOWN_MINUTES=
# Default: (unset)
ARTIST_COOLDOWN_S=
# Default: (unset)
WATCHLIST_INTERVAL=
# Default: false
WATCHLIST_TIMER_ENABLED=false
# Default: 86400.0
WATCHLIST_TIMER_INTERVAL_S=86400.0
# Default: 20
ORCH_GLOBAL_CONCURRENCY=20
# Default: 5
ORCH_HEARTBEAT_S=5
# Default: 200
ORCH_POLL_INTERVAL_MS=200
# Default: 5000
ORCH_POLL_INTERVAL_MAX_MS=5000
# Default: 30
ORCH_VISIBILITY_TIMEOUT_S=30
# Default: 5
ORCH_POOL_SYNC=5
# Default: 5
ORCH_POOL_MATCHING=5
# Default: 5
ORCH_POOL_RETRY=5
# Default: 5
ORCH_POOL_ARTIST_REFRESH=5
# Default: 5
ORCH_POOL_ARTIST_DELTA=5
# Default: (unset JSON map)
ORCH_PRIORITY_JSON=
# Default: (unset CSV map)
ORCH_PRIORITY_CSV=
# Default: (unset shared priority override)
ARTIST_PRIORITY=
# Default: (unset shared pool override)
ARTIST_POOL_CONCURRENCY=

########## Artist Sync ##########
# Default: false
ARTIST_SYNC_PRUNE=false
# Default: false
ARTIST_SYNC_HARD_DELETE=false
# Default: 0
ARTIST_SYNC_PRIORITY_DECAY=0
# Default: 50
ARTIST_STALENESS_MAX_MIN=50
# Default: 6
ARTIST_RETRY_BUDGET_MAX=6

########## Miscellaneous ##########
# Default: ./music
MUSIC_DIR=./music
# Default: (unset)
SYNC_WORKER_CONCURRENCY=
# Default: 800
SECRET_VALIDATE_TIMEOUT_MS=800
# Default: 3
SECRET_VALIDATE_MAX_PER_MIN=3

